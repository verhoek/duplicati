

function post_to_forum () {
	DISCOURSE_TOKEN_FILE="${HOME}/.config/discourse-api-token"
	DISCOURSE_TOKEN=$(cat "${DISCOURSE_TOKEN_FILE}")

	if [ "x${DISCOURSE_TOKEN}" == "x" ]; then
		echo "No DISCOURSE_TOKEN found in environment, you can manually create the post on the forum"
	else

		body="# [${RELEASE_VERSION}-${RELEASE_NAME}](https://github.com/duplicati/duplicati/releases/tag/v${RELEASE_VERSION}-${RELEASE_NAME})

	${RELEASE_CHANGEINFO_NEWS}
	"

		DISCOURSE_USERNAME=$(echo "${DISCOURSE_TOKEN}" | cut -d ":" -f 1)
		DISCOURSE_APIKEY=$(echo "${DISCOURSE_TOKEN}" | cut -d ":" -f 2)

		curl -X POST "https://forum.duplicati.com/posts" \
			-F "api_key=${DISCOURSE_APIKEY}" \
			-F "api_username=${DISCOURSE_USERNAME}" \
			-F "category=Releases" \
			-F "title=Release: ${RELEASE_VERSION} (${RELEASE_TYPE}) ${RELEASE_TIMESTAMP}" \
			-F "raw=${body}"
	fi
}
